use andalucia_db;
SET FOREIGN_KEY_CHECKS=0;
INSERT INTO personas VALUES
(1091,'Margarita','Romero','M','1958-06-10','Cádiz','Jerez','Primarios','Ama de Casa',0,'Casada',2,'Bajo','Ama de Casa',NULL,NULL),
(1092,'Crisostomo','Rosales','H','1950-02-15','Almería','Roquetas','Secundarios','Jubilado',11000,'Casado',2,'Medio','Jubilado',NULL,NULL),
(1093,'Natividad','Rossi','M','1954-08-23','Almería','Roquetas','Primarios','Ama de Casa',0,'Casada',2,'Medio','Ama de Casa',NULL,NULL),
(1094,'Demóstenes','Roza','H','1948-04-07','Huelva','Huelva','Primarios','Jubilado',8000,'Casado',2,'Bajo','Jubilado',NULL,NULL),
(1095,'Octavia','Rubio','M','1952-10-14','Huelva','Huelva','Primarios','Ama de Casa',0,'Casada',2,'Bajo','Ama de Casa',NULL,NULL),
(1096,'Donaciano','Rueda','H','1956-07-29','Sevilla','Dos Hermanas','Secundarios','Jubilado',12500,'Casado',1,'Medio','Jubilado',NULL,NULL),
(1097,'Perpetua','Ruelas','M','1960-01-06','Sevilla','Dos Hermanas','Primarios','Ama de Casa',0,'Casada',1,'Medio','Ama de Casa',NULL,NULL),
(1098,'Doroteo','Ruiz','H','1952-11-18','Málaga','Marbella','Secundarios','Jubilado',14000,'Casado',2,'Medio','Jubilado',NULL,NULL),
(1099,'Prudencia','Salas','M','1956-05-25','Málaga','Marbella','Secundarios','Ama de Casa',0,'Casada',2,'Medio','Ama de Casa',NULL,NULL),
(1100,'Egidio','Salazar','H','1950-03-11','Cádiz','Cádiz','Primarios','Jubilado',9500,'Casado',2,'Bajo','Jubilado',NULL,NULL),
(1101,'Quiteria','Salcedo','M','1954-09-19','Cádiz','Cádiz','Primarios','Ama de Casa',0,'Casada',2,'Bajo','Ama de Casa',NULL,NULL),
(1102,'Eligio','Salinas','H','1948-07-02','Granada','Motril','Secundarios','Jubilado',10500,'Casado',2,'Bajo','Jubilado',NULL,NULL),
(1103,'Rafaela','Saltara','M','1952-01-08','Granada','Motril','Primarios','Ama de Casa',0,'Casada',2,'Bajo','Ama de Casa',NULL,NULL),
(1104,'Epifanio','Samaniego','H','1956-11-14','Jaén','Úbeda','Primarios','Jubilado',8500,'Casado',3,'Bajo','Jubilado',NULL,1111),
(1105,'Sabina','Sampedro','M','1960-06-22','Jaén','Úbeda','Primarios','Ama de Casa',0,'Casada',3,'Bajo','Ama de Casa',NULL,NULL),
(1106,'Estanislao','Sánchez','H','1954-09-03','Córdoba','Lucena','Secundarios','Jubilado',11000,'Casado',1,'Medio','Jubilado',NULL,NULL),
(1107,'Tecla','Sandoval','M','1958-03-11','Córdoba','Lucena','Primarios','Ama de Casa',0,'Casada',1,'Medio','Ama de Casa',NULL,NULL),
(1108,'Eusebio','Santamaría','H','1950-12-27','Sevilla','Alcalá','Secundarios','Jubilado',12000,'Casado',2,'Medio','Jubilado',NULL,NULL),
(1109,'Ursulina','Santana','M','1954-04-05','Sevilla','Alcalá','Primarios','Ama de Casa',0,'Casada',2,'Medio','Ama de Casa',NULL,NULL),
(1110,'Eutimio','Sarmiento','H','1948-08-19','Málaga','Fuengirola','Secundarios','Jubilado',13500,'Casado',2,'Medio','Jubilado',NULL,NULL),
(1111,'Valeriana','Satauste','M','1952-02-26','Málaga','Fuengirola','Secundarios','Ama de Casa',0,'Casada',2,'Medio','Ama de Casa',NULL,NULL),
(1112,'Evaristo','Saucedo','H','1956-06-04','Huelva','Lepe','Primarios','Jubilado',8000,'Casado',1,'Bajo','Jubilado',NULL,NULL),
(1113,'Walburga','Saudo','M','1960-12-12','Huelva','Lepe','Primarios','Ama de Casa',0,'Casada',1,'Bajo','Ama de Casa',NULL,NULL),
(1114,'Fabiano','Sauz','H','1952-04-18','Almería','El Ejido','Secundarios','Jubilado',10000,'Casado',2,'Bajo','Jubilado',NULL,NULL),
(1115,'Xenia','Sayas','M','1956-09-26','Almería','El Ejido','Primarios','Ama de Casa',0,'Casada',2,'Bajo','Ama de Casa',NULL,NULL),
(1116,'Faustino','Saynos','H','1950-07-08','Cádiz','San Fernando','Secundarios','Jubilado',9500,'Casado',2,'Bajo','Jubilado',NULL,NULL),
(1117,'Yanira','Saza','M','1954-01-15','Cádiz','San Fernando','Primarios','Ama de Casa',0,'Casada',2,'Bajo','Ama de Casa',1117,NULL),
(1118,'Fulgencio','Scheid','H','1948-10-29','Sevilla','Coria','Secundarios','Jubilado',11500,'Casado',1,'Medio','Jubilado',NULL,NULL),
(1119,'Zenaida','Seco','M','1952-03-07','Sevilla','Coria','Primarios','Ama de Casa',0,'Casada',1,'Medio','Ama de Casa',NULL,NULL),
(1120,'Gerasimo','Secreto','H','1956-08-13','Sevilla','Sevilla','Secundarios','Jubilado',12500,'Casado',2,'Medio','Jubilado',NULL,NULL),
(1121,'Abigaíl','Segovia','M','1960-04-21','Sevilla','Sevilla','Primarios','Ama de Casa',0,'Casada',2,'Medio','Ama de Casa',NULL,NULL),
(1122,'Gildardo','Seis','H','1954-01-05','Málaga','Málaga','Primarios','Jubilado',9000,'Casado',1,'Bajo','Jubilado',NULL,NULL),
(1123,'Blanca','Seisdos','M','1958-07-11','Málaga','Málaga','Primarios','Ama de Casa',0,'Casada',1,'Bajo','Ama de Casa',NULL,NULL),
(1124,'Gislerio','Selma','H','1950-11-17','Córdoba','Córdoba','Secundarios','Jubilado',10500,'Casado',2,'Bajo','Jubilado',NULL,NULL),
(1125,'Cristina','Semence','M','1954-05-24','Córdoba','Córdoba','Primarios','Ama de Casa',0,'Casada',2,'Bajo','Ama de Casa',NULL,NULL),
(1126,'Godofredo','Semeno','H','1948-02-08','Granada','Granada','Primarios','Jubilado',8500,'Casado',3,'Bajo','Jubilado',NULL,NULL),
(1127,'Dionisia','Sencillo','M','1952-08-16','Granada','Granada','Primarios','Ama de Casa',0,'Casada',3,'Bajo','Ama de Casa',NULL,NULL),
(1128,'Gómez','Senén','H','1956-04-24','Jaén','Linares','Secundarios','Jubilado',11500,'Casado',3,'Bajo','Jubilado',NULL,NULL),
(1129,'Emilia','Senís','M','1960-10-02','Jaén','Linares','Primarios','Ama de Casa',0,'Casada',3,'Bajo','Ama de Casa',NULL,NULL),
(1130,'Graciano','Seno','H','1952-09-11','Cádiz','Jerez','Secundarios','Jubilado',10000,'Casado',1,'Bajo','Jubilado',NULL,NULL),
(1131,'Fabiana','Senra','M','1956-02-19','Cádiz','Jerez','Primarios','Ama de Casa',0,'Casada',1,'Bajo','Ama de Casa',NULL,NULL),
(1132,'Graciliano','Senta','H','1950-06-27','Almería','Adra','Primarios','Jubilado',8000,'Casado',1,'Bajo','Jubilado',NULL,NULL),
(1133,'Gabriela','Sentana','M','1954-12-05','Almería','Adra','Primarios','Ama de Casa',0,'Casada',1,'Bajo','Ama de Casa',NULL,1100);

SET FOREIGN_KEY_CHECKS=1;


-- Ejercicios tabla personas

--     Muestra la media de salario agrupada por ocupación
SELECT ocupacion, AVG(salario) AS salario_medio
FROM personas
GROUP BY ocupacion;

--     Muestra la media de salarios en cada provincia
SELECT provincia, AVG(salario) AS salario_medio
FROM personas
GROUP BY provincia;

--     Muestra la media de edad de cada nivel socioeconómico
SELECT nivel_socioeconomico, AVG(YEAR(CURDATE()) - YEAR(fecha_nacimiento)) as media_edad from personas GROUP BY nivel_socioeconomico

--     Dime la edad de las personas de menos de 60 años ordenadas por situación laboral.
SELECT nombre, YEAR(CURDATE()) - YEAR(fecha_nacimiento) AS edad, situacion_laboral
FROM personas
WHERE YEAR(CURDATE()) - YEAR(fecha_nacimiento) < 60
ORDER BY situacion_laboral;

--     Muestra el nombre de la persona parada de más edad.
SELECT nombre, YEAR(CURDATE()) - YEAR(fecha_nacimiento) AS edad, situacion_laboral
FROM personas
WHERE situacion_laboral = 'parado'
ORDER BY edad DESC
LIMIT 1;
--     Dime la provincia con la máxima edad media.
SELECT provincia, AVG(YEAR(CURDATE()) - YEAR(fecha_nacimiento)) as media_edad from personas GROUP BY provincia order by edad_media DESC LIMIT 1;

--     Dime los hijos del ciudadano con id 1190
SELECT numero_hijos, nombre from personas where id='1190' -- MAL--
SELECT nombre FROM personas WHERE id_padre = 1190; --BIEN--

--     Muestra los nietos del ciudadano con id = 1190
SELECT nombre from personas where id_abuelo = 1190

--     Muestra la madre con más hijos
SELECT nombre, numero_hijos FROM personas ORDER BY numero_hijos DESC LIMIT 1;

--     Muestra la media de hijos por hombre
SELECT AVG(numero_hijos) as media_hijos from personas where sexo='H';

--     Dime la media de hijos de personas con menos de 30 años.
SELECT AVG(numero_hijos), YEAR(CURDATE()) - YEAR(fecha_nacimiento) AS edad from personas where edad < 30;

--     Muestra el valor de numero de hijos que más se repite entre las mujeres.
SELECT numero_hijos, COUNT(*) AS veces
FROM personas
WHERE sexo = 'M'
GROUP BY numero_hijos
ORDER BY veces DESC
LIMIT 1;
--     Dime la media de edad de las mujeres sin hijos de Sevilla provincia
SELECT AVG(YEAR(CURDATE()) - YEAR(fecha_nacimiento)) AS media_edad FROM personas WHERE sexo = 'M' AND provincia = 'Sevilla' AND numero_hijos = 0;

--     Dime la media de las modas del campo edad.

--     Dime la provincia con menor edad media de las personas estudiantes.

--     Órdename los municipios por numero total de hijos en cada uno.

--     ordena las provincias por mayor número medio de hijos por mujer (tasa de natalidad)

--     Dime los municipios que no superan la tasa de reemplazo (más de 2 hijos por mujer) pero tienen un salario medio mayor a 3000 euros al mes

--     Dime la provincia con la moda de edad más alta.

--     Dime los 5 sevillanos (municipio) de más edad ordenados por la longitud de su apellido.

--     Dime el municicpio con menos tasa de natalidad (num_hijos por mujer) de entre los municipios de Huelva con salario medio menor de 20000 euros anuales .
